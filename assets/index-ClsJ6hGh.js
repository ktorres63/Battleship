(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();class h{hits;length;name;constructor(e,t="ship"){if(e<=0)throw new Error("Ship length must be positive.");this.length=e,this.hits=0,this.name=t}hit(){this.isSunk()||this.hits++}isSunk(){return this.hits>=this.length}}class B{shipPlacement;attackStatus;ships=[];size;missedAttacks=[];constructor(e){if(e<=0)throw new Error("GameBoard size must be positive.");this.size=e,this.shipPlacement=Array.from({length:e},()=>Array(e).fill(null)),this.attackStatus=Array.from({length:e},()=>Array(e).fill(null))}placeShip(e,t,r){const{x:s,y:a}=t,n=e.length;if(r=="horizontal"&&s+n>this.size)throw new Error("Placement out of bounds");if(r=="vertical"&&a+n>this.size)throw new Error("Placement out of bounds");if(r==="horizontal")for(let c=0;c<n;c++)this.shipPlacement[a][s+c]=e;if(r==="vertical")for(let c=0;c<n;c++)this.shipPlacement[a+c][s]=e;this.ships.includes(e)||this.ships.push(e)}receiveAttack(e){const t=this.shipPlacement[e.y][e.x],{x:r,y:s}=e;if(this.attackStatus[e.y][e.x]!==null)throw new Error("Spot already attacked");if(t==null)return this.missedAttacks.push(e),this.attackStatus[s][r]="missed","miss";if(typeof t.hit=="function")return t.hit(),this.attackStatus[s][r]="hit","hit";throw new Error("invalid cell state")}allShipsSunk(){return this.ships.length==0?!1:this.ships.every(e=>e.isSunk())}}class S{type;board;availableMoves=[];constructor(e){this.type=e,this.board=new B(10),this.generateAllMoves()}generateAllMoves(){for(let e=0;e<this.board.size;e++)for(let t=0;t<this.board.size;t++)this.availableMoves.push({x:t,y:e})}attack(e,t){return e.receiveAttack(t)}randomAttack(e){if(this.availableMoves.length===0)return null;const t=Math.floor(Math.random()*this.availableMoves.length),s=this.availableMoves.splice(t,1)[0];if(!s)throw new Error("Unexpected: coord was undefined");return e.receiveAttack(s),s}}class x{player;computer;started=!1;constructor(){this.player=new S("human"),this.computer=new S("computer")}start(){this.staticPlaceComputerShips(),this.started=!0}staticPlaceComputerShips(){const e=[new h(5,"Carrier"),new h(4,"Battleship"),new h(3,"Cruiser"),new h(3,"Submarine"),new h(2,"Destroyer")];this.computer.board.placeShip(e[0],{x:0,y:0},"horizontal"),this.computer.board.placeShip(e[1],{x:2,y:2},"vertical"),this.computer.board.placeShip(e[2],{x:5,y:1},"horizontal"),this.computer.board.placeShip(e[3],{x:7,y:3},"vertical"),this.computer.board.placeShip(e[4],{x:4,y:6},"horizontal")}playerAttack(e){try{const t=this.computer.board.receiveAttack(e);return this.isHumanWinner()||this.computerAttack(),t}catch(t){throw t}}computerAttack(){const e=this.computer.randomAttack(this.player.board);return e||null}isHumanWinner(){return this.computer.board.ships.length===0?!1:this.computer.board.allShipsSunk()}isComputerWinner(){return this.player.board.allShipsSunk()}getGameStatus(){const e=this.isHumanWinner(),t=this.isComputerWinner();return e&&t?"draw":e?"human_wins":t?"computer_wins":"in_progress"}placeComputerShips(){[new h(5),new h(4),new h(3),new h(3),new h(2)].forEach(t=>{let r=!1;for(;!r;){const s=Math.random()<.5?"horizontal":"vertical",a=s==="horizontal"?this.computer.board.size-t.length:this.computer.board.size-1,n=s==="vertical"?this.computer.board.size-t.length:this.computer.board.size-1,c=Math.floor(Math.random()*(a+1)),o=Math.floor(Math.random()*(n+1));this.canPlaceShip(this.computer.board,t,{x:c,y:o},s)&&(this.computer.board.placeShip(t,{x:c,y:o},s),r=!0)}})}canPlaceShip(e,t,r,s){const{x:a,y:n}=r,c=t.length;if(s=="horizontal"){if(a+c>e.size)return!1;for(let o=0;o<c;o++)if(e.shipPlacement[n][a+o]!==null)return!1}if(s=="vertical"){if(n+c>e.size)return!1;for(let o=0;o<c;o++)if(e.shipPlacement[n+o][a]!==null)return!1}return!0}}function k(i,e=10){i.innerHTML="";for(let t=0;t<e;t++)for(let r=0;r<e;r++){const s=document.createElement("div");s.dataset.y=String(t),s.dataset.x=String(r),s.className="cell",s.classList.add("bg-blue-800","border","border-blue-600"),s.classList.add("hover:bg-blue-700","cursor-pointer"),i.appendChild(s)}}function P(i,e){e.length!==0&&e.forEach(({x:t,y:r})=>{const s=i.querySelector(`[data-y="${r}"][data-x="${t}"]`);s&&s.classList.add("bg-amber-600")})}let m="horizontal",p=null,f=new Map;function A(i,e,t){i.player.board=new i.player.board.constructor(10),f.clear();const r=document.getElementById("axis-x"),s=document.getElementById("axis-y"),a=()=>{m==="horizontal"?(r?.classList.add("bg-blue-600","ring-2","ring-blue-300"),r?.classList.remove("bg-blue-500"),s?.classList.remove("bg-blue-600","ring-2","ring-blue-300"),s?.classList.add("bg-blue-500")):(s?.classList.add("bg-blue-600","ring-2","ring-blue-300"),s?.classList.remove("bg-blue-500"),r?.classList.remove("bg-blue-600","ring-2","ring-blue-300"),r?.classList.add("bg-blue-500"))};a(),r?.addEventListener("click",()=>{m="horizontal",a()}),s?.addEventListener("click",()=>{m="vertical",a()}),t.querySelectorAll(".draggable-ship").forEach(o=>{const l=o;l.setAttribute("draggable","true"),l.addEventListener("dragstart",d=>{p=l,l.classList.add("opacity-50"),d.dataTransfer&&(d.dataTransfer.effectAllowed="move")}),l.addEventListener("dragend",()=>{l.classList.remove("opacity-50"),p=null})}),e.querySelectorAll(".cell").forEach(o=>{const l=o;l.addEventListener("dragover",d=>{d.preventDefault(),d.dataTransfer&&(d.dataTransfer.dropEffect="move")}),l.addEventListener("dragenter",d=>{if(d.preventDefault(),!p)return;const u=parseInt(l.dataset.x||"0"),y=parseInt(l.dataset.y||"0"),v=parseInt(p.dataset.length||"0"),g=E(u,y,v,m),b=L(g,e);M(e,g,b)}),l.addEventListener("dragleave",d=>{const u=d.relatedTarget;(!u||!l.contains(u))&&w(e)}),l.addEventListener("drop",d=>{if(d.preventDefault(),w(e),!p)return;const u=parseInt(l.dataset.x||"0"),y=parseInt(l.dataset.y||"0"),v=parseInt(p.dataset.length||"0"),g=p.dataset.ship||"",b=E(u,y,v,m);L(b,e)&&I(i,p,b,g,m,e)})}),e.addEventListener("contextmenu",o=>{o.preventDefault();const l=o.target;if(!l.classList.contains("cell"))return;const d=parseInt(l.dataset.x||"0"),u=parseInt(l.dataset.y||"0");z(i,d,u,e,t)})}function E(i,e,t,r){const s=[];for(let a=0;a<t;a++)r==="horizontal"?s.push({x:i+a,y:e}):s.push({x:i,y:e+a});return s}function L(i,e){for(const t of i)if(t.x<0||t.x>=10||t.y<0||t.y>=10)return!1;for(const t of i){const r=e.querySelector(`[data-y="${t.y}"][data-x="${t.x}"]`);if(r&&r.classList.contains("bg-amber-600"))return!1}return!0}function M(i,e,t){w(i),e.forEach(r=>{const s=i.querySelector(`[data-y="${r.y}"][data-x="${r.x}"]`);s&&(t?s.classList.add("bg-green-500","bg-opacity-50"):s.classList.add("bg-red-500","bg-opacity-50"))})}function w(i){i.querySelectorAll(".cell").forEach(t=>{t.classList.remove("bg-green-500","bg-red-500","bg-opacity-50")})}function I(i,e,t,r,s,a,n){const c=t.length,o=new h(c,r);try{i.player.board.placeShip(o,t[0],s),P(a,t),f.set(r,{ship:o,coords:t,orientation:s,element:e}),e.remove(),console.log("Ship placed:",r)}catch(l){console.error("Error:",l),alert("Ship cannot be placed here")}}function z(i,e,t,r,s){for(const[a,n]of f.entries())if(n.coords.some(o=>o.x===e&&o.y===t)){n.coords.forEach(o=>{const l=r.querySelector(`[data-y="${o.y}"][data-x="${o.x}"]`);l&&l.classList.remove("bg-amber-600")}),s.appendChild(n.element),f.delete(a),C(i),console.log("Barco removido:",a),console.log("Barcos restantes:",i.player.board.ships.length);break}}function C(i,e){i.player.board=new i.player.board.constructor(10);for(const[t,r]of f.entries())try{i.player.board.placeShip(r.ship,r.coords[0],r.orientation)}catch(s){console.error(`Error al reconstruir barco ${t}:`,s)}console.log("Tablero reconstruido. Barcos totales:",i.player.board.ships.length)}function V(){return f}class T{game;viewManager;element=null;confirmBtn=null;constructor(e,t){this.game=e,this.viewManager=t}init(){this.element=document.getElementById("placement-view"),this.confirmBtn=document.getElementById("confirm-placement");const e=document.getElementById("player-draggable-board"),t=document.getElementById("ships-container");k(e),A(this.game,e,t),this.confirmBtn?.addEventListener("click",()=>{const r=V();if(r.size!==5){alert(`You must place all 5 ships. You have ${r.size} placed.`);return}this.viewManager.showBattleView(),this.game.start()})}show(){this.element?.classList.remove("hidden")}hide(){this.element?.classList.add("hidden")}}class ${game;viewManager;element=null;playerBoardEl=null;computerBoardEl=null;hitSound;missSound;soundsLoaded=!1;constructor(e,t){this.game=e,this.viewManager=t,this.hitSound=new Audio("/sounds/BangLong.ogg"),this.missSound=new Audio("/sounds/watersplash.ogg"),[this.hitSound,this.missSound].forEach(r=>{r.preload="auto",r.volume=1})}unlockSounds(){this.soundsLoaded||([this.hitSound,this.missSound].forEach(e=>{e.muted=!0,e.play().then(()=>{e.pause(),e.currentTime=0,e.muted=!1}).catch(()=>{})}),this.soundsLoaded=!0,console.log("ðŸ”“ unlock audio"))}playSound(e){e.pause(),e.currentTime=0,e.play().catch(t=>{console.warn("block audio :",t)})}init(){this.element=document.getElementById("battle-view"),this.playerBoardEl=document.getElementById("player-board"),this.computerBoardEl=document.getElementById("computer-board"),this.renderBoards(),this.setupComputerBoardEvents()}renderBoards(){!this.playerBoardEl||!this.computerBoardEl||(this.renderPlayerBoard(),this.renderComputerBoard())}renderPlayerBoard(){if(this.playerBoardEl){this.playerBoardEl.innerHTML="";for(let e=0;e<this.game.player.board.size;e++)for(let t=0;t<this.game.player.board.size;t++){const r=document.createElement("div");r.className="cell",r.classList.add("bg-blue-800","border","border-blue-600"),r.dataset.x=String(t),r.dataset.y=String(e),this.game.player.board.shipPlacement[e]?.[t]&&r.classList.add("bg-amber-600","border-amber-700");const a=this.game.player.board.attackStatus[e]?.[t];a==="hit"?(r.classList.remove("bg-amber-600","border-amber-700"),r.classList.add("bg-red-600","border-red-700"),r.innerHTML='<span class="text-white font-bold">X</span>'):a==="missed"&&r.classList.add("bg-gray-600","border-gray-700"),this.playerBoardEl.appendChild(r)}}}renderComputerBoard(){if(this.computerBoardEl){this.computerBoardEl.innerHTML="";for(let e=0;e<this.game.computer.board.size;e++)for(let t=0;t<this.game.computer.board.size;t++){const r=document.createElement("div");r.className="cell cursor-pointer hover:bg-red-700",r.classList.add("bg-blue-800","border","border-blue-600"),r.dataset.x=String(t),r.dataset.y=String(e);const s=this.game.computer.board.attackStatus[e]?.[t];s==="hit"?(r.classList.add("bg-red-600","border-red-700"),r.classList.remove("hover:bg-red-700")):s==="missed"&&(r.classList.add("bg-gray-600","border-gray-700"),r.classList.remove("hover:bg-red-700")),this.computerBoardEl.appendChild(r)}}}setupComputerBoardEvents(){this.computerBoardEl&&this.computerBoardEl.addEventListener("click",e=>{this.unlockSounds;const r=e.target.closest(".cell");if(!r||!this.computerBoardEl?.contains(r))return;const s=parseInt(r.dataset.x||"0"),a=parseInt(r.dataset.y||"0");if(this.game.computer.board.attackStatus[a]?.[s]!==null){console.log("Cell already attacked");return}try{const n=this.game.playerAttack({x:s,y:a});console.log(`Ataque en (${s}, ${a}): ${n}`),n==="hit"?this.playSound(this.hitSound):n==="miss"&&this.playSound(this.missSound),this.renderBoards(),this.checkGameStatus()}catch(n){console.error("Error al atacar:",n)}})}checkGameStatus(){const e=this.game.getGameStatus();e==="human_wins"?setTimeout(()=>{alert("ðŸŽ‰ Victory! You've destroyed the enemy fleet.")},100):e==="computer_wins"?setTimeout(()=>{alert("ðŸ’¥ You've been defeated! The computer sank all of your ships.")},100):e==="draw"&&setTimeout(()=>{alert("ðŸ¤ It's a tie! Both fleets have been destroyed.")},100)}show(){this.element?.classList.remove("hidden"),this.renderBoards()}hide(){this.element?.classList.add("hidden")}}class q{game;placementView;battleView;constructor(e){this.game=e,this.placementView=new T(e,this),this.battleView=new $(e,this)}start(){this.placementView.init(),this.battleView.init(),this.showPlacementView()}showPlacementView(){this.battleView.hide(),this.placementView.show()}showBattleView(){this.placementView.hide(),this.battleView.show()}}const O=document.getElementById("app");if(!O)throw new Error("Root #app not found");const G=new x,H=new q(G);H.start();const N=document.getElementById("new-game");N?.addEventListener("click",()=>{location.reload()});
